<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bulk Filtration Tool</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
      :root { --bg:#fff; --ink:#111; --muted:#6b7280; --border:#e5e7eb; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; color: var(--ink); background: var(--bg); }
      .container { max-width: 880px; margin: 0 auto; }
      .card { border: 1px solid var(--border); border-radius: 16px; padding: 16px; background: #fff; }
      .row { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
      select, button { padding: 8px 12px; border-radius: 12px; border: 1px solid var(--border); background: #f9fafb; }
      button:hover { background: #f3f4f6; cursor:pointer; }
      h1 { font-size: 28px; margin: 0 0 8px 0; }
      h2 { font-size: 20px; margin: 24px 0 12px 0; }
      .muted { color: var(--muted); font-size: 12px; }
      .output { display: grid; gap: 12px; }
      .k { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
      .v { font-size: 16px; font-weight: 600; }
      .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; }
      .section { margin-top: 8px; }
      a { text-decoration: underline; color: #0645ad; }
      .modal-backdrop { position: fixed; inset:0; background: rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; }
      .modal { width: min(960px, 92vw); max-height: 90vh; overflow:auto; background:#fff; border-radius:16px; border:1px solid var(--border); padding:16px; }
      .modal header { display:flex; align-items:center; justify-content:space-between; gap:12px; }
      .modal h3 { margin: 0; font-size: 20px; }
      .modal .actions { display:flex; gap:10px; }
      table { border-collapse: collapse; width: 100%; margin-top: 12px; }
      th, td { border: 1px solid var(--border); padding: 8px 10px; vertical-align: top; }
      th { text-align: left; background: #f9fafb; }
      tr:nth-child(even) { background: #fafafa; }
      .num { width: 56px; }
      textarea.entry { width:100%; min-height:40px; resize:vertical; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/javascript">
      const DATA_COLLECTION_ROWS = [{"num": "1", "needed": "Number of Tanks", "example": "Count every storage vessel included in scope"}, {"num": "2", "needed": "Size (capacity) of Each Tank", "example": "List gallons or liters per tank (e.g., \"Tank 1 - 500 gal\")"}, {"num": "3", "needed": "Fluid Type", "example": "Fuel examples: #2, B15, R99\nOil examples: AW46, ISO 320"}, {"num": "4", "needed": "Dispense Temperature", "example": "Give a range (e.g., \u201c\u221210 \u00b0F to 95 \u00b0F\u201d); \u201cambient\u201d isn\u2019t enough"}, {"num": "5", "needed": "Fuel / Fluid Usage Rate", "example": "Monthly or annual volume consumed (gallons or liters)"}, {"num": "6", "needed": "% HPCR Equipment", "example": "Percent of fleet using high-pressure common-rail engines"}, {"num": "7", "needed": "Dispense Flow Rate per Tank", "example": "GPM or LPM at the nozzle for each dispenser"}, {"num": "8", "needed": "Pump Type & Model", "example": "Gear, vane,  diaphragm, pneumatic ram, etc. (relief-valve setting is avail.)"}, {"num": "9", "needed": "Tank Filling Method", "example": "Gravity-fed, bottom fill, top fill, cam-lock transfer, etc."}, {"num": "10", "needed": "Current Fuel / Fluid Issues", "example": "E.g., filter plugging, injector failures, varnish, downtime"}, {"num": "11", "needed": "Photos (attach)", "example": "For each tank: 1) inlet / fill, 2) breather, 3) outlet, 4) wide shot"}];
      const EMAIL_BY_CHANNEL = {"AIT":"marcos.bruno@donaldson.com","Motion":"andy.klugherz@donaldson.com","Fastenal":"nicholas.botnen@donaldson.com","Wajax":"jessica.schaffer@donaldson.com","Other":"MSASRTECH@donaldson.com"};
      function emailFor(channel){ return EMAIL_BY_CHANNEL[channel] || EMAIL_BY_CHANNEL['Other']; }

      const APPLICATION_TYPES = [
        "Bulk Fuel Tank (single)",
        "Bulk Fuel Tank (single with multiple outlet)",
        "Bulk Fuel Tanks (multiple)",
        "Slip Tank",
        "Bulk Fluids",
      ];
      const FLOW_RATES = [
        "35 GPM and under",
        "35 GPM and under (multiple outlets)",
        "Over 35 GPM",
      ];
      const STORAGE_SIZES = [
        "10K gallons or under",
        "Over 10K gallons",
      ];
      const PUMP_TYPES = [
        "Gear pump ≤350 psi",
        "Pneumatic ram pump",
      ];
      const CHANNELS = ["AIT","Motion","Fastenal","Wajax","Other"];

      function computeB8(B2, B3, B4) {
        if (B2 === "Slip Tank") return "Simple Bulk Fuel";
        if (B2 === "Bulk Fuel Tank (single)" && B3 === "35 GPM and under" && B4 === "10K gallons or under") return "Simple Bulk Fuel";
        if (B2 === "Bulk Fluids") return "Bulk Fluids";
        return "Complex Bulk Fuel";
      }
      function computeB9(B8, B2, B5) {
        if (B8 === "Simple Bulk Fuel") {
          return B2 === "Slip Tank" ? "Recommend Compact Kit (X011745)" : "Recommend Clean & Dry Kit (X011449)";
        }
        if (B8 === "Bulk Fluids") {
          return B5 === "Pneumatic ram pump" ? "Use Bulk hP filters" : "Use Blue Can filters";
        }
        return "Complete the Data Collection List";
      }
      function computeB10(B8, B6) {
        if (B8 === "Simple Bulk Fuel") return "TM handles; use HighSpot template";
        if (B6 === "AIT" || B6 === "Motion" || B6 === "Fastenal" || B6 === "Wajax") return "Contact MRO Sales";
        return "Contact Sr. Tech Support";
      }

      function openModal() { document.querySelector('.modal-backdrop').style.display = 'flex'; }
      function closeModal() { document.querySelector('.modal-backdrop').style.display = 'none'; }
      function downloadExcelFromTable() {
        const table = document.getElementById('dcl-table');
        const rows = Array.from(table.querySelectorAll('tbody tr')).map(tr => {
          const tds = tr.querySelectorAll('td');
          return {
            '#': tds[0].textContent.trim(),
            'Data Needed': tds[1].textContent.trim(),
            'Guidance / Example': tds[2].textContent.trim(),
            'Your input': tds[3].querySelector('textarea').value.trim()
          };
        });
        const ws = XLSX.utils.json_to_sheet(rows, {header: ['#','Data Needed','Guidance / Example','Your input']});
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Data Collection');
        XLSX.writeFile(wb, 'DataCollectionList.xlsx');
      }

      const e = React.createElement;

      function App() {
        const [B2, setB2] = React.useState("");
        const [B3, setB3] = React.useState("");
        const [B4, setB4] = React.useState("");
        const [B5, setB5] = React.useState("");
        const [B6, setB6] = React.useState("");

        const B8 = React.useMemo(() => {
          if (!B2) return "";
          if (B2 === "Bulk Fluids") return "Bulk Fluids";
          if (!B3 || !B4) return "";
          return computeB8(B2, B3, B4);
        }, [B2, B3, B4]);

        const B9 = React.useMemo(() => {
          if (!B8) return "";
          if (B8 === "Bulk Fluids") {
            return B5 ? computeB9(B8, B2, B5) : "";
          }
          return computeB9(B8, B2, B5);
        }, [B8, B2, B5]);

        const B10 = React.useMemo(() => (B8 ? computeB10(B8, B6) : ""), [B8, B6]);

        const bulkReady = B2 === "Bulk Fluids" ? (B5 && B6) : (B3 && B4 && B6);
        const showResults = !!(B2 && bulkReady);

        const renderedRef = React.useRef(false);
        function ensureTable() {
          if (renderedRef.current) return;
          const tbody = document.querySelector('#dcl-table tbody');
          if (!tbody) return;
          DATA_COLLECTION_ROWS.forEach((r) => {
            const tr = document.createElement('tr');
            const td1 = document.createElement('td'); td1.className='num'; td1.textContent = r.num || '';
            const td2 = document.createElement('td'); td2.textContent = r.needed || '';
            const td3 = document.createElement('td'); td3.textContent = r.example || '';
            const td4 = document.createElement('td'); const ta = document.createElement('textarea'); ta.className='entry'; ta.placeholder='Enter details'; td4.appendChild(ta);
            tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3); tr.appendChild(td4);
            tbody.appendChild(tr);
          });
          renderedRef.current = true;
        }

        return e(React.Fragment, null,
          e('div', {className:'container'},
            e('header', null,
              e('h1', null, 'Bulk Filtration Tool'),
              e('p', {className:'muted'}, 'Select your options to see Category, Recommendation, and Notes.')
            ),
            e('section', {className:'section grid'},
              e('div', {className:'row'},
                e('label', {className:'muted'}, 'Application'),
                e('select', {value:B2, onChange:(ev)=>{ setB2(ev.target.value); if (ev.target.value !== 'Bulk Fluids') setB5(''); }},
                  e('option', {value:''}, 'Select'),
                  ...APPLICATION_TYPES.map(opt => e('option', {key:opt, value:opt}, opt))
                )
              ),
              B2 !== 'Bulk Fluids' && e(React.Fragment, null,
                e('div', {className:'row'},
                  e('label', {className:'muted'}, 'Flow rate'),
                  e('select', {value:B3, onChange:(ev)=>setB3(ev.target.value)},
                    e('option', {value:''}, 'Select'),
                    ...FLOW_RATES.map(opt => e('option', {key:opt, value:opt}, opt))
                  )
                ),
                e('div', {className:'row'},
                  e('label', {className:'muted'}, 'Storage size'),
                  e('select', {value:B4, onChange:(ev)=>setB4(ev.target.value)},
                    e('option', {value:''}, 'Select'),
                    ...STORAGE_SIZES.map(opt => e('option', {key:opt, value:opt}, opt))
                  )
                ),
              ),
              B2 === 'Bulk Fluids' && e('div', {className:'row'},
                e('label', {className:'muted'}, 'Pump type'),
                e('select', {value:B5, onChange:(ev)=>setB5(ev.target.value)},
                  e('option', {value:''}, 'Select'),
                  ...PUMP_TYPES.map(opt => e('option', {key:opt, value:opt}, opt))
                )
              ),
              e('div', {className:'row'},
                e('label', {className:'muted'}, 'Channel'),
                e('select', {value:B6, onChange:(ev)=>setB6(ev.target.value)},
                  e('option', {value:''}, 'Select'),
                  ...CHANNELS.map(opt => e('option', {key:opt, value:opt}, opt))
                )
              ),
              e('div', {className:'row'},
                e('button', {onClick:()=>{ setB2(''); setB3(''); setB4(''); setB5(''); setB6(''); }}, 'Reset')
              )
            ),
            e('section', {className:'section'},
              e('h2', null, 'Output'),
              !showResults
                ? e('div', {className:'muted'}, B2==='Bulk Fluids' ? 'Select Pump type and Channel to see results.' : 'Select Flow rate, Storage size, and Channel to see results.')
                : e('div', {className:'output'},
                    e('div', {className:'card'},
                      e('div', {className:'k'}, 'Category'),
                      e('div', {className:'v'}, B8)
                    ),
                    e('div', {className:'card'},
                      e('div', {className:'k'}, 'Recommendation'),
                      e('div', {className:'v'}, B9),
                      B9 === 'Complete the Data Collection List' && e('div', {style:{marginTop:'6px'}},
                        e('a', {
                          href:'#',
                          onClick:(ev)=>{ ev.preventDefault(); ensureTable(); openModal(); }
                        }, 'Open the Data Collection List')
                      )
                    ),
                    e('div', {className:'card'},
                      e('div', {className:'k'}, 'Notes'),
                      e('div', {className:'v'}, B10),
                      (B10 === 'Contact MRO Sales' || B10 === 'Contact Sr. Tech Support') && e('div', {style:{marginTop:'6px'}},
                        e('a', {
                          href: (()=>{ const addr = emailFor(B6); const subj = encodeURIComponent('Bulk Filtration – Support Request'); return `mailto:${addr}?subject=${subj}`; })()
                        }, 'Email ' + (B10 === 'Contact MRO Sales' ? 'MRO Sales' : 'Sr. Tech Support'))
                      ),
                      B10 === 'TM handles; use HighSpot template' && e('div', {style:{marginTop:'6px'}},
                        e('a', {href:'https://donaldson.highspot.com/items/684b0971375835f487ac8673?lfrm=shp.1', target:'_blank', rel:'noopener noreferrer'}, 'Open the HighSpot template')
                      )
                    )
                  )
            )
          ),
          e('div', {className:'modal-backdrop'},
            e('div', {className:'modal'},
              e('header', null,
                e('h3', null, 'Data Collection List'),
                e('div', {className:'actions'},
                  e('button', {onClick: downloadExcelFromTable}, 'Download Excel'),
                  e('button', {onClick: closeModal}, 'Close')
                )
              ),
              e('table', {id:'dcl-table'},
                e('thead', null,
                  e('tr', null,
                    e('th', {className:'num'}, '#'),
                    e('th', null, 'Data Needed'),
                    e('th', null, 'Guidance / Example'),
                    e('th', null, 'Your input')
                  )
                ),
                e('tbody', null)
              )
            )
          )
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(App));
    </script>
  </body>
</html>
